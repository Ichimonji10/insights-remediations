'use strict';

const Handler = require('./Handler');
const errors = require('../errors');

const vulnerabilities = require('../connectors/vulnerabilities');
const vulnerabilityFactory = new(require('../generator/factories/VulnerabilityFactory'))();
const contentServerResolver = new(require('../resolutions/resolvers/ContentServerResolver'))();

module.exports = class VulnerabilityHandler extends Handler {
    async getIssueDetails (id) {
        const raw = await vulnerabilities.getRule(id.issue);

        if (!raw) {
            throw errors.unknownIssue(id);
        }

        return {
            description: raw.description,
            raw
        };
    }

    getResolutionResolver () {
        return contentServerResolver;
    }

    getPlayFactory () {
        return vulnerabilityFactory;
    }
};
